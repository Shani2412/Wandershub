<% layout('/layouts/boilerplate') %>

<h1 class="mb-4">All Listings</h1>

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">

  <% for (let listing of allListings) { %>

    <div class="col">
      <a 
        href="/listings/<%= listing._id %>" 
        class="listing-link text-decoration-none text-dark"
      >
        <div class="card h-100 shadow-sm">

          <% 
            let imgUrl = '/images/placeholder.jpg';
            if (listing.images && listing.images.length > 0) {
              imgUrl = listing.images[0].url;
            }
          %>

          <img
            src="<%= imgUrl %>"
            class="card-img-top"
            alt="<%= listing.title %>"
            style="height: 18rem; object-fit: cover;"
          />

          <div class="card-body">

            <!-- Title -->
            <h5 class="card-title mb-2">
              <%= listing.title %>
            </h5>

            <!-- Price -->
            <p class="fw-bold mb-1">
              <% if (listing.price != null) { %>
                â‚¹<%= listing.price.toLocaleString('en-IN') %>
              <% } else { %>
                Price not available
              <% } %>
            </p>

            <!-- Location -->
            <% if (listing.location && listing.country) { %>
              <p class="text-muted mb-0">
                <%= listing.location %>, <%= listing.country %>
              </p>
            <% } %>

          </div>

        </div>
      </a>
    </div>

  <% } %>
</div>
